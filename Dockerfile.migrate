FROM golang:1.23-alpine AS builder
RUN go install -tags 'postgres' github.com/golang-migrate/migrate/v4/cmd/migrate@v4.17.0

FROM alpine:3.19
COPY --from=builder /go/bin/migrate /usr/local/bin/migrate
COPY internal/database/migrations /migrations

# Use shell form to allow environment variable expansion
ENTRYPOINT ["/bin/sh", "-c"]
CMD ["migrate -path /migrations -database \"$DATABASE_URL\" up"]
